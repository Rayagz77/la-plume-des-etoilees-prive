{% extends 'base.html' %}

{% block title %}Page d'enregistrement{% endblock %}

{% block content %}
<main class="register_main">
    <h2>Créez un compte</h2>
    <div class="register_container">
             
        <!-- Affichage des messages flash -->
        {% with messages = get_flashed_messages(with_categories=True) %}
            {% if messages %}
                <div class="flashes">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        
        <form action="{{ url_for('register.register') }}" method="POST" class="registration-form">
            <input type="text" name="user_firstname" placeholder="Prénom" minlength="3" required>
            <span class="error-message" id="firstname-error"></span>
            
            <input type="text" name="user_lastname" placeholder="Nom de famille" minlength="3" required>
            <span class="error-message" id="lastname-error"></span>
            
            <input type="email" name="user_email" placeholder="Email" pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" required>
            <span class="error-message" id="email-error"></span>
            
            <input type="password" name="user_password" placeholder="Mot de passe" minlength="12" required>
            <span class="error-message" id="password-error"></span>
            
            <input type="text" name="user_phone" placeholder="Téléphone" pattern="^\+?\d{7,15}$" required>
            <span class="error-message" id="phone-error"></span>

            <div class="consent">
                <input type="checkbox" name="user_consent" required>
                <label for="user_consent">J'accepte la collecte de mes données personnelles pour la création de ce compte.</label>
            </div>
            <span class="error-message" id="consent-error"></span>
            
            <button type="submit">S'inscrire</button>
        </form>
        <div><p>Vous avez déjà un compte ? <a href="{{ url_for('login.login') }}">Connectez-vous</a></p></div>
    </div>
</main>


<script>
    document.querySelector('.registration-form').addEventListener('submit', function(event) {
        const errorMessages = document.querySelectorAll('.error-message');
        errorMessages.forEach(error => error.textContent = '');

        let hasError = false;
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        const phonePattern = /^\+?\d{7,15}$/;

        const firstname = document.querySelector('input[name="user_firstname"]');
        if (firstname.value.length < 3) {
            document.getElementById('firstname-error').textContent = 'Le prénom doit contenir au moins 3 caractères.';
            hasError = true;
        }

        const lastname = document.querySelector('input[name="user_lastname"]');
        if (lastname.value.length < 3) {
            document.getElementById('lastname-error').textContent = 'Le nom de famille doit contenir au moins 3 caractères.';
            hasError = true;
        }

        const email = document.querySelector('input[name="user_email"]');
        if (!emailPattern.test(email.value)) {
            document.getElementById('email-error').textContent = 'Veuillez entrer une adresse email valide.';
            hasError = true;
        }

        const password = document.querySelector('input[name="user_password"]');
        if (password.value.length < 12) {
            document.getElementById('password-error').textContent = 'Le mot de passe doit contenir au moins 12 caractères.';
            hasError = true;
        }

        const phone = document.querySelector('input[name="user_phone"]');
        if (phone.value && !phonePattern.test(phone.value)) {
            document.getElementById('phone-error').textContent = 'Veuillez entrer un numéro de téléphone valide.';
            hasError = true;
        }

        const consent = document.querySelector('input[name="user_consent"]');
        if (!consent.checked) {
            document.getElementById('consent-error').textContent = 'Vous devez accepter la collecte de vos données personnelles.';
            hasError = true;
        }

        if (hasError) {
            event.preventDefault();
        }
    });
</script>
{% endblock %}
