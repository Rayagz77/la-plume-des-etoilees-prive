{% extends 'base.html' %}

{% block title %}Page d'accueil{% endblock %}

{% block content %}
<main>
    <div class="search-bar">
        <input type="text" placeholder="Trouver un produit..." class="search-input">
        <button class="search-button">
            <i class="fa fa-search"></i>
        </button>
    </div>

    <div class="horizontal-menu">
        <a href="#">Accueil</a>
        <a href="#">Catégories</a>
        <a href="#">Offres spéciales</a>
        <a href="#">Nouveautés</a>
        <a href="#">Contact</a>
    </div>

    <div class="sidebar-menu-container">
        <div class="sidebar">
            <div class="message_box">
                {% with messages = get_flashed_messages(with_categories=True) %}
                    {% if messages %}
                        <div class="flashes">
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }}">{{ message }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
            </div>
            <div class="box">
                <h3>IA</h3>
                <p>Recommandations IA.</p>
            </div>
            <div class="box">
                <h3 class="filter-category">Filtrer par catégorie</h3>
                <select id="category-filter" onchange="filterByCategory()">
                    <option value="">Choisir une catégorie</option>
                    {% for category in categories %}
                        <option value="{{ category.category_id }}" {% if selected_category_id == category.category_id %}selected{% endif %}>
                            {{ category.category_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="book-container">
            <div class="book-gallery">
                <h3>Livres Disponibles</h3>
                <div class="book-list">
                    {% for book in books %}
                        <div class="book-box">
                            <img src="{{ book.book_image_url }}" alt="{{ book.book_title }}">
                            <h4>{{ book.book_title }}</h4>
                            <p>Auteur: {{ book.author.author_firstname }} {{ book.author.author_lastname }}</p>
                            <p>Prix: {{ book.book_price }} €</p>
                            <form action="{{ url_for('cart_bp.add_to_cart', book_id=book.book_id) }}" method="post">
                                <button type="submit">Ajouter au Panier</button>
                            </form>
                        </div>
                    {% else %}
                        <p>Aucun livre disponible.</p>
                    {% endfor %}
                </div>
            </div>
        
            <!-- Pagination -->
            <div class="pagination">
                {% if pagination.has_prev %}
                    <a href="{{ url_for('home', page=pagination.prev_num) }}">Précédent</a>
                {% endif %}
                <span>Page {{ pagination.page }} / {{ pagination.pages }}</span>
                {% if pagination.has_next %}
                    <a href="{{ url_for('home', page=pagination.next_num) }}">Suivant</a>
                {% endif %}
            </div>
        </div>
        
        
        {# <div class="pagination">
            {% if pagination.has_prev %}
                <a href="{{ url_for('home', page=pagination.prev_num) }}">Précédent</a>
            {% endif %}
            <span>Page {{ pagination.page }} / {{ pagination.pages }}</span>
            {% if pagination.has_next %}
                <a href="{{ url_for('home', page=pagination.next_num) }}">Suivant</a>
            {% endif %}
        </div> #}
    </div>
</main>
<script>
    function filterByCategory() {
        const selectedCategory = document.getElementById("category-filter").value;
        const url = selectedCategory ? `/?category=${selectedCategory}` : '/';
        window.location.href = url;
    }
</script>
{% endblock %}
